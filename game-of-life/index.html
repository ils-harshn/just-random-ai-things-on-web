<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Game of Life</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #000;
      color: #0f0;
      font-family: 'Courier New', monospace;
      overflow: hidden;
      height: 100vh;
    }

    #container {
      display: flex;
      height: 100vh;
    }

    #canvas-wrapper {
      flex: 1;
      position: relative;
      cursor: grab;
    }

    #canvas-wrapper.grabbing {
      cursor: grabbing;
    }

    canvas {
      display: block;
      width: 100%;
      height: 100%;
    }

    #controls {
      width: 280px;
      background: #111;
      padding: 20px;
      border-left: 2px solid #0f0;
      overflow-y: auto;
      transition: transform 0.3s ease;
    }

    #controls.hidden {
      transform: translateX(100%);
      position: absolute;
      right: 0;
      height: 100vh;
    }

    #fullscreen-exit {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      background: #000;
      color: #0f0;
      border: 2px solid #0f0;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      z-index: 1000;
      display: none;
    }

    #fullscreen-exit:hover {
      background: #0f0;
      color: #000;
    }

    h2 {
      color: #0f0;
      margin-bottom: 15px;
      font-size: 18px;
      border-bottom: 1px solid #0f0;
      padding-bottom: 5px;
    }

    .control-group {
      margin-bottom: 20px;
    }

    button {
      width: 100%;
      padding: 10px;
      margin-bottom: 8px;
      background: #000;
      color: #0f0;
      border: 2px solid #0f0;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      transition: all 0.2s;
    }

    button:hover {
      background: #0f0;
      color: #000;
    }

    button:active {
      transform: scale(0.98);
    }

    .speed-control {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .speed-control label {
      flex: 1;
      font-size: 14px;
    }

    .speed-control input {
      width: 60px;
      padding: 5px;
      background: #000;
      color: #0f0;
      border: 1px solid #0f0;
      font-family: 'Courier New', monospace;
    }

    .checkbox-control {
      margin: 10px 0;
    }

    .checkbox-control label {
      display: flex;
      align-items: center;
      cursor: pointer;
      font-size: 13px;
    }

    .checkbox-control input[type="checkbox"] {
      margin-right: 10px;
      width: 16px;
      height: 16px;
      cursor: pointer;
      accent-color: #0f0;
    }

    .stats,
    .control-group {
      margin-top: 20px;
    }

    .stat-row {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      border-bottom: 1px solid #333;
      font-size: 13px;
    }

    .stat-label {
      color: #0a0;
    }

    .stat-value {
      color: #0f0;
      font-weight: bold;
    }

    .info {
      margin-top: 15px;
      padding: 10px;
      background: #0a0a0a;
      border: 1px solid #0f0;
      font-size: 11px;
      color: #0a0;
    }

    .info p {
      margin-bottom: 5px;
    }

    .controls-container {
      position: absolute;
      top: 2px;
      right: 20px;
      z-index: 1000;
      width: 38px;
      opacity: 0.25;
      transition: opacity 0.3s;
    }

    .controls-container:hover {
      opacity: 1;
    }
  </style>
</head>

<body>
  <div id="container">
    <div id="canvas-wrapper">
      <canvas id="gameCanvas"></canvas>
    </div>
    <div class="controls-container">
      <button id="controls-toggler">x</button>
    </div>
    <div id="controls">
      <h2>CONTROLS</h2>
      <div class="control-group">
        <button id="startBtn">START</button>
        <button id="stopBtn">STOP</button>
        <button id="clearBtn">CLEAR</button>
        <button id="randomBtn">RANDOM SEED</button>
        <button id="fullscreenBtn">FULLSCREEN</button>
      </div>

      <div class="control-group">
        <h2>SPEED</h2>
        <div class="speed-control">
          <label>Gen/sec:</label>
          <input type="number" id="speedInput" value="10" min="1" max="60">
        </div>
      </div>

      <div class="control-group">
        <h2>VIEW OPTIONS</h2>
        <div class="checkbox-control">
          <label>
            <input type="checkbox" id="gridToggle" checked>
            Show Grid Borders
          </label>
        </div>
      </div>

      <div class="stats">
        <h2>STATISTICS</h2>
        <div class="stat-row">
          <span class="stat-label">Generation:</span>
          <span class="stat-value" id="generation">0</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Initial Cells:</span>
          <span class="stat-value" id="initialCells">0</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Current Population:</span>
          <span class="stat-value" id="liveCells">0</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Population Change:</span>
          <span class="stat-value" id="popChange">0</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Peak Population:</span>
          <span class="stat-value" id="peakPop">0</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Births This Gen:</span>
          <span class="stat-value" id="births">0</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Deaths This Gen:</span>
          <span class="stat-value" id="deaths">0</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Total Births:</span>
          <span class="stat-value" id="totalBirths">0</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Total Deaths:</span>
          <span class="stat-value" id="totalDeaths">0</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Stability:</span>
          <span class="stat-value" id="stability">-</span>
        </div>
      </div>

      <div class="control-group">
        <h2>PATTERNS</h2>
        <div id="patternsContainer"></div>
      </div>

      <div class="info">
        <p><strong>INSTRUCTIONS:</strong></p>
        <p>• Click cells to toggle</p>
        <p>• Drag to pan</p>
        <p>• Scroll to zoom</p>
        <p>• Space to start/stop</p>
      </div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const wrapper = document.getElementById('canvas-wrapper');

    // State
    let grid = new Map();
    let running = false;
    let cellSize = 20;
    let offsetX = 0;
    let offsetY = 0;
    let lastTime = 0;
    let speed = 10;
    let generation = 0;
    let initialCellCount = 0;
    let peakPopulation = 0;
    let totalBirths = 0;
    let totalDeaths = 0;
    let birthsThisGen = 0;
    let deathsThisGen = 0;
    let previousPopulation = 0;
    let stabilityCounter = 0;
    let showGrid = true;

    // Panning
    let isDragging = false;
    let dragStartX = 0;
    let dragStartY = 0;
    let dragOffsetX = 0;
    let dragOffsetY = 0;

    function resize() {
      canvas.width = wrapper.clientWidth;
      canvas.height = wrapper.clientHeight;
      draw();
    }

    function getCellKey(x, y) {
      return `${x},${y}`;
    }

    function parseCellKey(key) {
      const [x, y] = key.split(',').map(Number);
      return { x, y };
    }

    function toggleCell(x, y) {
      const key = getCellKey(x, y);
      if (grid.has(key)) {
        grid.delete(key);
      } else {
        grid.set(key, true);
      }
      if (!running && generation === 0) {
        initialCellCount = grid.size;
        updateStats();
      }
      draw();
    }

    function getNeighbors(x, y) {
      let count = 0;
      for (let dx = -1; dx <= 1; dx++) {
        for (let dy = -1; dy <= 1; dy++) {
          if (dx === 0 && dy === 0) continue;
          if (grid.has(getCellKey(x + dx, y + dy))) count++;
        }
      }
      return count;
    }

    function nextGeneration() {
      const newGrid = new Map();
      const toCheck = new Set();

      // Add all live cells and their neighbors to check list
      for (const key of grid.keys()) {
        const { x, y } = parseCellKey(key);
        for (let dx = -1; dx <= 1; dx++) {
          for (let dy = -1; dy <= 1; dy++) {
            toCheck.add(getCellKey(x + dx, y + dy));
          }
        }
      }

      const prevPopulation = grid.size;
      let births = 0;
      let deaths = 0;

      // Apply rules
      for (const key of toCheck) {
        const { x, y } = parseCellKey(key);
        const neighbors = getNeighbors(x, y);
        const isAlive = grid.has(key);

        if (isAlive && (neighbors === 2 || neighbors === 3)) {
          newGrid.set(key, true);
        } else if (!isAlive && neighbors === 3) {
          newGrid.set(key, true);
          births++;
        } else if (isAlive) {
          deaths++;
        }
      }

      grid = newGrid;
      generation++;

      const currentPopulation = grid.size;

      birthsThisGen = births;
      deathsThisGen = deaths;
      totalBirths += births;
      totalDeaths += deaths;

      peakPopulation = Math.max(peakPopulation, currentPopulation);

      // Check stability (same population for 3+ generations)
      if (currentPopulation === previousPopulation) {
        stabilityCounter++;
      } else {
        stabilityCounter = 0;
      }
      previousPopulation = currentPopulation;

      updateStats();
      draw();
    }

    function draw() {
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      const startCol = Math.floor(-offsetX / cellSize) - 1;
      const endCol = Math.ceil((canvas.width - offsetX) / cellSize) + 1;
      const startRow = Math.floor(-offsetY / cellSize) - 1;
      const endRow = Math.ceil((canvas.height - offsetY) / cellSize) + 1;

      // Draw grid (if enabled)
      if (showGrid) {
        // ctx.strokeStyle = '#fff';
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 1;

        for (let i = startCol; i <= endCol; i++) {
          const x = i * cellSize + offsetX;
          ctx.beginPath();
          ctx.moveTo(x, 0);
          ctx.lineTo(x, canvas.height);
          ctx.stroke();
        }

        for (let i = startRow; i <= endRow; i++) {
          const y = i * cellSize + offsetY;
          ctx.beginPath();
          ctx.moveTo(0, y);
          ctx.lineTo(canvas.width, y);
          ctx.stroke();
        }
      }

      // Draw cells
      ctx.fillStyle = '#0f0';
      for (const key of grid.keys()) {
        const { x, y } = parseCellKey(key);
        const screenX = x * cellSize + offsetX;
        const screenY = y * cellSize + offsetY;

        if (screenX + cellSize > 0 && screenX < canvas.width &&
          screenY + cellSize > 0 && screenY < canvas.height) {
          if (showGrid) {
            ctx.fillRect(screenX + 1, screenY + 1, cellSize - 2, cellSize - 2);
          } else {
            ctx.fillRect(screenX, screenY, cellSize, cellSize);
          }
        }
      }
    }

    function updateStats() {
      const currentPop = grid.size;
      const popChange = generation > 0 ? currentPop - previousPopulation : 0;
      const changeSymbol = popChange > 0 ? '+' : '';

      let stabilityText = '-';
      if (stabilityCounter >= 3) {
        stabilityText = 'STABLE';
      } else if (stabilityCounter > 0) {
        stabilityText = `${stabilityCounter}/3`;
      } else if (generation > 0) {
        stabilityText = 'CHANGING';
      }

      document.getElementById('generation').textContent = generation;
      document.getElementById('initialCells').textContent = initialCellCount;
      document.getElementById('liveCells').textContent = currentPop;
      document.getElementById('popChange').textContent = generation > 0 ? `${changeSymbol}${popChange}` : '0';
      document.getElementById('peakPop').textContent = peakPopulation;
      document.getElementById('births').textContent = birthsThisGen;
      document.getElementById('deaths').textContent = deathsThisGen;
      document.getElementById('totalBirths').textContent = totalBirths;
      document.getElementById('totalDeaths').textContent = totalDeaths;
      document.getElementById('stability').textContent = stabilityText;
    }

    function start() {
      if (!running) {
        running = true;
        lastTime = performance.now();
        requestAnimationFrame(gameLoop);
      }
    }

    function stop() {
      running = false;
    }

    function clear() {
      grid.clear();
      generation = 0;
      initialCellCount = 0;
      peakPopulation = 0;
      totalBirths = 0;
      totalDeaths = 0;
      birthsThisGen = 0;
      deathsThisGen = 0;
      previousPopulation = 0;
      stabilityCounter = 0;
      updateStats();
      draw();
    }

    function randomSeed() {
      clear();
      const cols = Math.floor(canvas.width / cellSize);
      const rows = Math.floor(canvas.height / cellSize);
      const centerX = Math.floor(-offsetX / cellSize);
      const centerY = Math.floor(-offsetY / cellSize);

      for (let i = 0; i < (cols * rows) / 8; i++) {
        const x = centerX + Math.floor(Math.random() * cols) - cols / 2;
        const y = centerY + Math.floor(Math.random() * rows) - rows / 2;
        grid.set(getCellKey(x, y), true);
      }

      initialCellCount = grid.size;
      updateStats();
      draw();
    }

    function gameLoop(currentTime) {
      if (!running) return;

      const deltaTime = currentTime - lastTime;
      const interval = 1000 / speed;

      if (deltaTime >= interval) {
        nextGeneration();
        lastTime = currentTime - (deltaTime % interval);
      }

      requestAnimationFrame(gameLoop);
    }

    // Event listeners
    canvas.addEventListener('click', (e) => {
      if (isDragging) return;
      const rect = canvas.getBoundingClientRect();
      const x = Math.floor((e.clientX - rect.left - offsetX) / cellSize);
      const y = Math.floor((e.clientY - rect.top - offsetY) / cellSize);
      toggleCell(x, y);
    });

    canvas.addEventListener('mousedown', (e) => {
      isDragging = true;
      dragStartX = e.clientX;
      dragStartY = e.clientY;
      dragOffsetX = offsetX;
      dragOffsetY = offsetY;
      wrapper.classList.add('grabbing');
    });

    canvas.addEventListener('mousemove', (e) => {
      if (isDragging) {
        offsetX = dragOffsetX + (e.clientX - dragStartX);
        offsetY = dragOffsetY + (e.clientY - dragStartY);
        draw();
      }
    });

    canvas.addEventListener('mouseup', () => {
      isDragging = false;
      wrapper.classList.remove('grabbing');
    });

    canvas.addEventListener('mouseleave', () => {
      isDragging = false;
      wrapper.classList.remove('grabbing');
    });

    canvas.addEventListener('wheel', (e) => {
      e.preventDefault();
      const rect = canvas.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      const mouseY = e.clientY - rect.top;

      const worldX = (mouseX - offsetX) / cellSize;
      const worldY = (mouseY - offsetY) / cellSize;

      const zoom = e.deltaY < 0 ? 1.1 : 0.9;
      const newCellSize = Math.max(1, Math.min(100, cellSize * zoom));

      if (newCellSize !== cellSize) {
        offsetX = mouseX - worldX * newCellSize;
        offsetY = mouseY - worldY * newCellSize;
        cellSize = newCellSize;
        draw();
      }
    });

    document.getElementById('startBtn').addEventListener('click', start);
    document.getElementById('stopBtn').addEventListener('click', stop);
    document.getElementById('clearBtn').addEventListener('click', clear);
    document.getElementById('randomBtn').addEventListener('click', randomSeed);
    document.getElementById('controls-toggler').addEventListener('click', () => {
      const controls = document.getElementById('controls');
      controls.classList.toggle('hidden');
      const toggler = document.getElementById('controls-toggler');
      toggler.textContent = controls.classList.contains('hidden') ? '+' : 'x';
    });
    document.getElementById('fullscreenBtn').addEventListener('click', () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    });

    document.getElementById('gridToggle').addEventListener('change', (e) => {
      showGrid = e.target.checked;
      draw();
    });

    document.getElementById('speedInput').addEventListener('input', (e) => {
      speed = Math.max(1, Math.min(60, parseInt(e.target.value) || 10));
      e.target.value = speed;
    });

    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space') {
        e.preventDefault();
        running ? stop() : start();
      }
    });

    window.addEventListener('resize', resize);

    // === PATTERN DATA ===
    const patterns = [
      {
        "name": "Glider",
        "cells": [
          [
            1,
            0
          ],
          [
            2,
            1
          ],
          [
            0,
            2
          ],
          [
            1,
            2
          ],
          [
            2,
            2
          ]
        ]
      },
      {
        "name": "Small Exploder",
        "cells": [
          [
            0,
            -1
          ],
          [
            -1,
            0
          ],
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            -1,
            1
          ],
          [
            1,
            1
          ],
          [
            0,
            2
          ]
        ]
      },
      {
        "name": "Exploder",
        "cells": [
          [
            -2,
            -2
          ],
          [
            2,
            -2
          ],
          [
            -2,
            -1
          ],
          [
            2,
            -1
          ],
          [
            -2,
            0
          ],
          [
            -1,
            0
          ],
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            -2,
            1
          ],
          [
            2,
            1
          ],
          [
            -2,
            2
          ],
          [
            2,
            2
          ]
        ]
      },
      {
        "name": "10 Cell Row",
        "cells": [
          [
            -5,
            0
          ],
          [
            -4,
            0
          ],
          [
            -3,
            0
          ],
          [
            -2,
            0
          ],
          [
            -1,
            0
          ],
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            3,
            0
          ],
          [
            4,
            0
          ]
        ]
      },
      {
        "name": "Pulsar",
        "cells": [
          [
            -6,
            -4
          ],
          [
            -5,
            -4
          ],
          [
            -4,
            -4
          ],
          [
            -2,
            -4
          ],
          [
            -1,
            -4
          ],
          [
            0,
            -4
          ],
          [
            -6,
            -9
          ],
          [
            -5,
            -9
          ],
          [
            -4,
            -9
          ],
          [
            -2,
            -9
          ],
          [
            -1,
            -9
          ],
          [
            0,
            -9
          ],
          [
            -8,
            -7
          ],
          [
            -3,
            -7
          ],
          [
            1,
            -7
          ],
          [
            6,
            -7
          ],
          [
            -8,
            -6
          ],
          [
            -3,
            -6
          ],
          [
            1,
            -6
          ],
          [
            6,
            -6
          ],
          [
            -8,
            -5
          ],
          [
            -3,
            -5
          ],
          [
            1,
            -5
          ],
          [
            6,
            -5
          ],
          [
            -8,
            -3
          ],
          [
            -3,
            -3
          ],
          [
            1,
            -3
          ],
          [
            6,
            -3
          ],
          [
            -8,
            -2
          ],
          [
            -3,
            -2
          ],
          [
            1,
            -2
          ],
          [
            6,
            -2
          ],
          [
            -8,
            -1
          ],
          [
            -3,
            -1
          ],
          [
            1,
            -1
          ],
          [
            6,
            -1
          ],
          [
            -6,
            0
          ],
          [
            -5,
            0
          ],
          [
            -4,
            0
          ],
          [
            -2,
            0
          ],
          [
            -1,
            0
          ],
          [
            0,
            0
          ],
          [
            -6,
            5
          ],
          [
            -5,
            5
          ],
          [
            -4,
            5
          ],
          [
            -2,
            5
          ],
          [
            -1,
            5
          ],
          [
            0,
            5
          ]
        ]
      },
      {
        "name": "Spaceship (Lightweight)",
        "cells": [
          [
            1,
            0
          ],
          [
            4,
            0
          ],
          [
            0,
            1
          ],
          [
            0,
            2
          ],
          [
            4,
            2
          ],
          [
            1,
            3
          ],
          [
            2,
            3
          ],
          [
            3,
            3
          ]
        ]
      },
      {
        "name": "Tumbler",
        "cells": [
          [
            -4,
            -3
          ],
          [
            -3,
            -3
          ],
          [
            -2,
            -3
          ],
          [
            -4,
            -2
          ],
          [
            -2,
            -2
          ],
          [
            -4,
            -1
          ],
          [
            -3,
            -1
          ],
          [
            -2,
            -1
          ],
          [
            2,
            -3
          ],
          [
            3,
            -3
          ],
          [
            4,
            -3
          ],
          [
            2,
            -2
          ],
          [
            4,
            -2
          ],
          [
            2,
            -1
          ],
          [
            3,
            -1
          ],
          [
            4,
            -1
          ],
          [
            -3,
            1
          ],
          [
            -2,
            1
          ],
          [
            2,
            1
          ],
          [
            3,
            1
          ],
          [
            -3,
            2
          ],
          [
            -2,
            2
          ],
          [
            2,
            2
          ],
          [
            3,
            2
          ],
          [
            -2,
            3
          ],
          [
            2,
            3
          ]
        ]
      },
      {
        "name": "Beacon",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            0,
            1
          ],
          [
            2,
            2
          ],
          [
            3,
            2
          ],
          [
            3,
            3
          ]
        ]
      },
      {
        "name": "Toad",
        "cells": [
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            3,
            0
          ],
          [
            0,
            1
          ],
          [
            1,
            1
          ],
          [
            2,
            1
          ]
        ]
      },
      {
        "name": "Blinker",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            2,
            0
          ]
        ]
      },
      {
        "name": "Gosper Glider Gun",
        "cells": [
          [
            5,
            1
          ],
          [
            5,
            2
          ],
          [
            6,
            1
          ],
          [
            6,
            2
          ],
          [
            5,
            11
          ],
          [
            6,
            11
          ],
          [
            7,
            11
          ],
          [
            4,
            12
          ],
          [
            8,
            12
          ],
          [
            3,
            13
          ],
          [
            9,
            13
          ],
          [
            3,
            14
          ],
          [
            9,
            14
          ],
          [
            6,
            15
          ],
          [
            4,
            16
          ],
          [
            8,
            16
          ],
          [
            5,
            17
          ],
          [
            6,
            17
          ],
          [
            7,
            17
          ],
          [
            6,
            18
          ],
          [
            3,
            21
          ],
          [
            4,
            21
          ],
          [
            5,
            21
          ],
          [
            3,
            22
          ],
          [
            4,
            22
          ],
          [
            5,
            22
          ],
          [
            2,
            23
          ],
          [
            6,
            23
          ],
          [
            1,
            25
          ],
          [
            2,
            25
          ],
          [
            6,
            25
          ],
          [
            7,
            25
          ],
          [
            3,
            35
          ],
          [
            4,
            35
          ],
          [
            3,
            36
          ],
          [
            4,
            36
          ]
        ]
      },
      {
        "name": "Pentadecathlon",
        "cells": [
          [
            0,
            -4
          ],
          [
            0,
            -3
          ],
          [
            -1,
            -2
          ],
          [
            1,
            -2
          ],
          [
            0,
            -1
          ],
          [
            0,
            0
          ],
          [
            0,
            1
          ],
          [
            -1,
            2
          ],
          [
            1,
            2
          ],
          [
            0,
            3
          ],
          [
            0,
            4
          ]
        ]
      },
      {
        "name": "Diehard",
        "cells": [
          [
            6,
            0
          ],
          [
            0,
            1
          ],
          [
            1,
            1
          ],
          [
            1,
            2
          ],
          [
            5,
            2
          ],
          [
            6,
            2
          ],
          [
            7,
            2
          ]
        ]
      },
      {
        "name": "Acorn",
        "cells": [
          [
            1,
            0
          ],
          [
            3,
            1
          ],
          [
            0,
            2
          ],
          [
            1,
            2
          ],
          [
            4,
            2
          ],
          [
            5,
            2
          ],
          [
            6,
            2
          ]
        ]
      },
      {
        "name": "R-pentomino",
        "cells": [
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            0,
            1
          ],
          [
            1,
            1
          ],
          [
            1,
            2
          ]
        ]
      },
      {
        "name": "Boat",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            0,
            1
          ],
          [
            2,
            1
          ],
          [
            1,
            2
          ]
        ]
      },
      {
        "name": "Loaf",
        "cells": [
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            0,
            1
          ],
          [
            3,
            1
          ],
          [
            1,
            2
          ],
          [
            3,
            2
          ],
          [
            2,
            3
          ]
        ]
      },
      {
        "name": "Tub",
        "cells": [
          [
            1,
            0
          ],
          [
            0,
            1
          ],
          [
            2,
            1
          ],
          [
            1,
            2
          ]
        ]
      },
      {
        "name": "Penta-decimator",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            0,
            1
          ],
          [
            2,
            1
          ],
          [
            0,
            2
          ],
          [
            1,
            2
          ],
          [
            2,
            2
          ]
        ]
      },
      {
        "name": "Queen Bee Shuttle",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            1
          ],
          [
            1,
            2
          ],
          [
            1,
            3
          ],
          [
            2,
            3
          ],
          [
            3,
            3
          ],
          [
            4,
            2
          ],
          [
            5,
            0
          ],
          [
            6,
            0
          ],
          [
            6,
            1
          ],
          [
            5,
            2
          ],
          [
            4,
            3
          ],
          [
            3,
            3
          ],
          [
            2,
            3
          ],
          [
            1,
            2
          ],
          [
            1,
            1
          ]
        ]
      },
      {
        "name": "Twin Bees Shuttle",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            1,
            1
          ],
          [
            2,
            2
          ],
          [
            3,
            2
          ],
          [
            3,
            3
          ],
          [
            2,
            4
          ],
          [
            1,
            5
          ],
          [
            0,
            6
          ]
        ]
      },
      {
        "name": "Clock",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            1,
            1
          ],
          [
            2,
            1
          ],
          [
            2,
            2
          ],
          [
            3,
            2
          ],
          [
            3,
            3
          ],
          [
            0,
            3
          ]
        ]
      },
      {
        "name": "Cross",
        "cells": [
          [
            0,
            0
          ],
          [
            0,
            1
          ],
          [
            0,
            2
          ],
          [
            -1,
            1
          ],
          [
            1,
            1
          ]
        ]
      },
      {
        "name": "Snake",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            1,
            1
          ],
          [
            2,
            1
          ],
          [
            2,
            2
          ],
          [
            3,
            2
          ]
        ]
      },
      {
        "name": "French Kiss",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            0,
            1
          ],
          [
            2,
            1
          ],
          [
            1,
            2
          ]
        ]
      },
      {
        "name": "Honey Farm",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            0,
            1
          ],
          [
            1,
            1
          ],
          [
            2,
            3
          ],
          [
            3,
            3
          ],
          [
            2,
            4
          ],
          [
            3,
            4
          ]
        ]
      },
      {
        "name": "Block",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            0,
            1
          ],
          [
            1,
            1
          ]
        ]
      },
      {
        "name": "Garden of Eden (partial)",
        "cells": [
          [
            0,
            0
          ],
          [
            2,
            0
          ],
          [
            1,
            1
          ],
          [
            0,
            2
          ],
          [
            2,
            2
          ]
        ]
      },
      {
        "name": "Backrake",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            1,
            1
          ],
          [
            2,
            2
          ],
          [
            3,
            2
          ],
          [
            3,
            3
          ],
          [
            2,
            4
          ],
          [
            1,
            5
          ],
          [
            0,
            6
          ],
          [
            5,
            8
          ],
          [
            6,
            8
          ],
          [
            7,
            8
          ],
          [
            5,
            9
          ],
          [
            7,
            9
          ],
          [
            5,
            10
          ],
          [
            6,
            10
          ],
          [
            7,
            10
          ]
        ]
      },
      {
        "name": "Infinite Growth (Breeder)",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            1,
            1
          ],
          [
            2,
            2
          ],
          [
            0,
            3
          ],
          [
            1,
            3
          ],
          [
            3,
            4
          ],
          [
            4,
            4
          ],
          [
            5,
            4
          ]
        ]
      },
      {
        "name": "Line Puff",
        "cells": [
          [
            -2,
            0
          ],
          [
            -1,
            0
          ],
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            -2,
            1
          ],
          [
            1,
            1
          ],
          [
            -2,
            2
          ],
          [
            1,
            2
          ],
          [
            -2,
            3
          ],
          [
            1,
            3
          ]
        ]
      },
      {
        "name": "Cloverleaf",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            0,
            1
          ],
          [
            2,
            1
          ],
          [
            0,
            2
          ],
          [
            1,
            2
          ],
          [
            2,
            2
          ],
          [
            4,
            0
          ],
          [
            4,
            2
          ]
        ]
      },
      {
        "name": "Pi Heptomino",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            0,
            1
          ],
          [
            2,
            1
          ],
          [
            0,
            2
          ],
          [
            2,
            2
          ]
        ]
      },
      {
        "name": "Infinite Growth (Schick Engine)",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            0,
            1
          ],
          [
            2,
            1
          ],
          [
            2,
            2
          ],
          [
            2,
            3
          ],
          [
            3,
            3
          ],
          [
            3,
            4
          ],
          [
            4,
            4
          ],
          [
            4,
            5
          ],
          [
            5,
            5
          ],
          [
            5,
            6
          ]
        ]
      },
      {
        "name": "Simkin Glider Gun",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            0,
            1
          ],
          [
            1,
            1
          ],
          [
            5,
            0
          ],
          [
            5,
            1
          ],
          [
            5,
            2
          ],
          [
            6,
            3
          ],
          [
            7,
            4
          ],
          [
            8,
            4
          ],
          [
            9,
            3
          ],
          [
            10,
            2
          ],
          [
            11,
            1
          ]
        ]
      },
      {
        "name": "Switch Engine",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            2,
            1
          ],
          [
            1,
            2
          ],
          [
            0,
            3
          ],
          [
            2,
            3
          ]
        ]
      },
      {
        "name": "Cordership",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            0,
            1
          ],
          [
            2,
            1
          ],
          [
            2,
            2
          ],
          [
            3,
            2
          ],
          [
            3,
            3
          ],
          [
            4,
            3
          ],
          [
            1,
            4
          ],
          [
            5,
            4
          ],
          [
            5,
            5
          ],
          [
            6,
            5
          ],
          [
            6,
            6
          ]
        ]
      },
      {
        "name": "Schick Engine",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            0,
            1
          ],
          [
            2,
            1
          ],
          [
            2,
            2
          ],
          [
            2,
            3
          ],
          [
            3,
            3
          ],
          [
            3,
            4
          ],
          [
            4,
            4
          ],
          [
            4,
            5
          ],
          [
            5,
            5
          ],
          [
            5,
            6
          ]
        ]
      },
      {
        "name": "Breeder",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            0,
            1
          ],
          [
            2,
            1
          ],
          [
            0,
            2
          ],
          [
            2,
            2
          ],
          [
            6,
            1
          ],
          [
            10,
            0
          ],
          [
            10,
            1
          ],
          [
            10,
            2
          ],
          [
            11,
            -1
          ],
          [
            11,
            3
          ],
          [
            12,
            -1
          ],
          [
            12,
            3
          ],
          [
            13,
            0
          ],
          [
            13,
            1
          ],
          [
            13,
            2
          ],
          [
            20,
            10
          ],
          [
            21,
            10
          ],
          [
            22,
            10
          ],
          [
            21,
            11
          ],
          [
            20,
            12
          ],
          [
            21,
            12
          ],
          [
            22,
            12
          ]
        ]
      },
      {
        "name": "Gosper’s Breeder",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            0,
            1
          ],
          [
            2,
            1
          ],
          [
            0,
            2
          ],
          [
            2,
            2
          ],
          [
            6,
            1
          ],
          [
            10,
            0
          ],
          [
            10,
            1
          ],
          [
            10,
            2
          ],
          [
            11,
            -1
          ],
          [
            11,
            3
          ],
          [
            12,
            -1
          ],
          [
            12,
            3
          ],
          [
            13,
            0
          ],
          [
            13,
            1
          ],
          [
            13,
            2
          ],
          [
            20,
            10
          ],
          [
            21,
            10
          ],
          [
            22,
            10
          ],
          [
            20,
            11
          ],
          [
            20,
            12
          ],
          [
            21,
            12
          ],
          [
            22,
            12
          ],
          [
            40,
            20
          ],
          [
            41,
            20
          ],
          [
            42,
            20
          ],
          [
            41,
            21
          ],
          [
            40,
            22
          ],
          [
            41,
            22
          ],
          [
            42,
            22
          ]
        ]
      },
      {
        "name": "Gemini",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            2,
            1
          ],
          [
            1,
            2
          ],
          [
            0,
            3
          ],
          [
            2,
            3
          ],
          [
            20,
            10
          ],
          [
            21,
            10
          ],
          [
            22,
            10
          ],
          [
            22,
            11
          ],
          [
            21,
            12
          ],
          [
            20,
            13
          ],
          [
            22,
            13
          ],
          [
            40,
            30
          ],
          [
            41,
            30
          ],
          [
            42,
            30
          ],
          [
            41,
            31
          ],
          [
            40,
            32
          ],
          [
            41,
            32
          ],
          [
            42,
            32
          ]
        ]
      },
      {
        "name": "Caterpillar",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            0,
            1
          ],
          [
            2,
            1
          ],
          [
            0,
            2
          ],
          [
            2,
            2
          ],
          [
            10,
            0
          ],
          [
            10,
            1
          ],
          [
            10,
            2
          ],
          [
            11,
            -1
          ],
          [
            11,
            3
          ],
          [
            12,
            -1
          ],
          [
            12,
            3
          ],
          [
            13,
            0
          ],
          [
            13,
            1
          ],
          [
            13,
            2
          ],
          [
            20,
            5
          ],
          [
            21,
            5
          ],
          [
            22,
            5
          ],
          [
            20,
            6
          ],
          [
            20,
            7
          ],
          [
            21,
            7
          ],
          [
            22,
            7
          ]
        ]
      },
      {
        "name": "Metapixel (Mini)",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            0,
            1
          ],
          [
            2,
            1
          ],
          [
            0,
            2
          ],
          [
            2,
            2
          ],
          [
            10,
            10
          ],
          [
            11,
            10
          ],
          [
            12,
            10
          ],
          [
            10,
            11
          ],
          [
            12,
            11
          ],
          [
            10,
            12
          ],
          [
            12,
            12
          ],
          [
            25,
            25
          ],
          [
            26,
            25
          ],
          [
            27,
            25
          ],
          [
            25,
            26
          ],
          [
            27,
            26
          ],
          [
            25,
            27
          ],
          [
            27,
            27
          ]
        ]
      },
      {
        "name": "Geminoid",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            0,
            1
          ],
          [
            2,
            1
          ],
          [
            0,
            2
          ],
          [
            2,
            2
          ],
          [
            5,
            5
          ],
          [
            6,
            5
          ],
          [
            7,
            5
          ],
          [
            5,
            6
          ],
          [
            5,
            7
          ],
          [
            6,
            7
          ],
          [
            7,
            7
          ],
          [
            15,
            10
          ],
          [
            16,
            10
          ],
          [
            17,
            10
          ],
          [
            15,
            11
          ],
          [
            15,
            12
          ],
          [
            16,
            12
          ],
          [
            17,
            12
          ]
        ]
      },
      {
        "name": "Eater Gun",
        "cells": [
          [
            0,
            0
          ],
          [
            1,
            0
          ],
          [
            2,
            0
          ],
          [
            0,
            1
          ],
          [
            2,
            1
          ],
          [
            0,
            2
          ],
          [
            2,
            2
          ],
          [
            10,
            0
          ],
          [
            10,
            1
          ],
          [
            10,
            2
          ],
          [
            11,
            -1
          ],
          [
            11,
            3
          ],
          [
            12,
            -1
          ],
          [
            12,
            3
          ],
          [
            13,
            0
          ],
          [
            13,
            1
          ],
          [
            13,
            2
          ],
          [
            20,
            10
          ],
          [
            21,
            10
          ],
          [
            22,
            10
          ],
          [
            20,
            11
          ],
          [
            20,
            12
          ],
          [
            21,
            12
          ],
          [
            22,
            12
          ]
        ]
      }
    ]
    // === RENDER PATTERN BUTTONS ===
    const patternsContainer = document.getElementById("patternsContainer");

    patterns.forEach((pattern) => {
      const btn = document.createElement("button");
      btn.textContent = pattern.name;
      btn.addEventListener("click", () => {
        // Get the visible center of the canvas in world coordinates
        const centerX = Math.floor((canvas.width / 2 - offsetX) / cellSize);
        const centerY = Math.floor((canvas.height / 2 - offsetY) / cellSize);

        placePattern(pattern.cells, centerX, centerY);
      });

      patternsContainer.appendChild(btn);
    });

    // === FUNCTION TO PLACE A PATTERN ===
    function placePattern(cells, originX = 0, originY = 0) {
      for (const [dx, dy] of cells) {
        const x = originX + dx;
        const y = originY + dy;
        grid.set(getCellKey(x, y), true);
      }
      initialCellCount = grid.size;
      updateStats();
      draw();
    }


    // Initialize
    resize();
    updateStats();
  </script>
</body>

</html>
